set -e

. ~/bin/lib/client.sh

read_client_data $1

client_value CONTAINER db_container
client_value DB db
client_value USER db_user

CONTAINER=${lower_client}_db
HOST=$(docker inspect -f '{{.NetworkSettings.IPAddress}}' $CONTAINER)
DB=${lower_client}_data
USER=${lower_client}_user

psql -U postgres -h $HOST -c "SELECT pg_terminate_backend(conn.pid) from pg_stat_activity conn where conn.datname = '$DB' or conn.datname = '${DB}_snapshot'"
dropdb -U postgres -h $HOST --if-exists ${DB}
createdb -U postgres -h $HOST -O $USER -T ${DB}_snapshot $DB
